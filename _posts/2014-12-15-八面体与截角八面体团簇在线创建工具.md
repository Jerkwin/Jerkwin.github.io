---
 layout: post
 title: 八面体与截角八面体团簇在线创建工具
 categories:
 - 科
 tags:
 - 数理
 - 编程
 - js
---

## 2014-12-15 17:14:38

团簇类型：
<input type="radio" name="clsType" id="oct" checked="checked" />八面体 &nbsp;&nbsp;&nbsp;&nbsp;
<input type="radio" name="clsType" id="trc" />截角八面体 <br/>

晶胞类型：
<input type="radio" name="cubType" id="sc" checked="checked" />简单立方(SC) &nbsp;&nbsp;&nbsp;&nbsp;
<input type="radio" name="cubType" id="bcc" />体心立方(BCC) &nbsp;&nbsp;&nbsp;&nbsp;
<input type="radio" name="cubType" id="fcc" />面心立方(FCC) <br/>

晶胞参数(&#197;)：
a <input type="box" id="a" value="1" /> &nbsp;&nbsp;&nbsp;&nbsp;
b <input type="box" id="b" value="1" /> &nbsp;&nbsp;&nbsp;&nbsp;
c <input type="box" id="c" value="1" /> <br/>

多边形边长(原子数)：
四边形 <input type="box" id="recNO" value="3" /> &nbsp;&nbsp;&nbsp;&nbsp;
六边形 <input type="box" id="hexNO" value="3" /> <br/>

<input type="button" value="创建" onClick="genCoor()" style="width:100px; height:30px" /> <br/>

<table><tr>
<td>
	团簇结构XYZ文件(C:正常位点; B:体心位点; F面心位点)<br/><textarea id="xyzCoor" style="width:400px; height:500px; resize: none"></textarea></td>
<td>
	<figure><figurecaption>团簇结构</figurecaption><br/>
	<script>
		var Mol=new ChemDoodle.TransformCanvas3D('Mol-1', 400,500);
		Mol.specs.backgroundColor='black';
		Mol.specs.set3DRepresentation('Ball and Stick');
		Mol.specs.projectionPerspective_3D = false;
		Mol.loadMolecule(ChemDoodle.readXYZ("", 1));
	</script></figure></td>
</tr></table>

<script>
var $=function(id){return document.getElementById(id)};

function genCoor() {
	var YesCut=$("trc").checked,
		YesBCC=$("bcc").checked, YesFCC=$("fcc").checked,
		Nrec=parseInt($("recNO").value), Nhex=parseInt($("hexNO").value),  // Nhex=N-2*Ntop; Nrec=Ntop+1
		a=parseFloat($("a").value), b=parseFloat($("b").value), c=parseFloat($("c").value)

	var Ntop=Nrec-1, Nedg=parseInt(Nhex)+parseInt(2*Ntop);

	var i, j, k, x, y, z;
	var Ntot=0, Satm=[], Xatm=[], Yatm=[], Zatm=[];
	for(i=-Nedg; i<=Nedg; i++) {
		for(j=-Nedg; j<=Nedg; j++) {
			for(k=-Nedg; k<=Nedg; k++) {
				Ntot++
				x=i*a; y=j*b; z=k*c
				Satm[Ntot]="C"; Xatm[Ntot]=x; Yatm[Ntot]=y; Zatm[Ntot]=z
				if(YesBCC) {
					Ntot++; Satm[Ntot]="B";
					Xatm[Ntot]=x+0.5*a; Yatm[Ntot]=y+0.5*b; Zatm[Ntot]=z+0.5*c
				} else if(YesFCC) {
					Ntot++; Satm[Ntot]="F";
					Xatm[Ntot]=x+0.5*a; Yatm[Ntot]=y+0.5*b; Zatm[Ntot]=z
					Ntot++; Satm[Ntot]="F";
					Xatm[Ntot]=x+0.5*a; Yatm[Ntot]=y;       Zatm[Ntot]=z+0.5*c
					Ntot++; Satm[Ntot]="F";
					Xatm[Ntot]=x;       Yatm[Ntot]=y+0.5*b; Zatm[Ntot]=z+0.5*c
				}
			}
		}
	}

	var Na=Nedg, Nb=Nedg, Nc=Nedg,
		Ra=1./(Na*a), Rb=1./(Nb*b), Rc=1./(Nc*c),
		Reps=1.-1./Nedg+1E-3, Ncut=Nedg-Ntop-0.5001;
	var Natm=0, YesIn=[];

	for(i=1; i<=Ntot; i++) {
		x=Xatm[i]; y=Yatm[i]; z=Zatm[i]
		if( x*Ra+y*Rb+z*Rc<Reps &&  x*Ra-y*Rb+z*Rc<Reps
		&& -x*Ra+y*Rb+z*Rc<Reps && -x*Ra-y*Rb+z*Rc<Reps
		&&  x*Ra+y*Rb-z*Rc<Reps &&  x*Ra-y*Rb-z*Rc<Reps
		&& -x*Ra+y*Rb-z*Rc<Reps && -x*Ra-y*Rb-z*Rc<Reps ) {
			if(YesCut) {
				if(-Ncut*a<x && x<Ncut*a && -Ncut*b<y && y<Ncut*b && -Ncut*c<z && z<Ncut*c) {
					Natm++; YesIn[i]=1
				}
			} else {
				Natm++; YesIn[i]=1
			}
		}
	}

	var Fmol=Natm+"\n"+"BCC= "+YesBCC+"  FCC= "+YesFCC+"  Nrec= "+Nrec+"  Nhex= "+Nhex+"\n"
	for(i=1; i<=Ntot; i++) {
		if(YesIn[i]) Fmol += fmtStr(Satm[i],4)+fmtNum(Xatm[i],12.6)+fmtNum(Yatm[i],12.6)+fmtNum(Zatm[i],12.6)+"\n"
	}
	$("xyzCoor").value=Fmol
	Mol.loadMolecule(ChemDoodle.readXYZ(Fmol, 1));
}

function fmtNum(num, fmt) {
	var fmt=String(fmt), m=fmt.split(".")[0]
	num=num.toFixed(fmt.split(".")[1])
	if(num.length<m) num=Array(m-num.length+1).join(" ")+num
	return num
}
function fmtStr(str, fmt) {
	if(str.length<fmt) str += Array(fmt-str.length+1).join(" ")
	return str
}

</script>
